<html>
<head>
</head>
<body>
<script type="text/javascript">
	//高阶函数withLogin,用来判断当前用户状态
	(function(){
		var getLogin=function(){
			//用随机数的方式来模拟一个获取用户信息的方法
			var a=parseInt(Math.random()*10).toFixed(0);
			if(a%2==0){
				return {login:false}
			}
			return {
				login:true,
				userinfo:{
					nickname:'jake',
					vip:11,
					userid:'666666'
				}
			}
		}
		
		var withLogin=function(basicFn){
			var loginInfo=getLogin();
			//将loginInfo以参数的形式传入基础函数中
			return basicFn.bind(null,loginInfo);
		}
		
		window.withLogin=withLogin;
	})();
	
	(function(){
		var withLogin=window.withLogin;
		var renderIndex=function(loginInfo){
			//这里处理index页面的逻辑
			if(loginInfo.login){
				//处理已经登录之后的逻辑
				console.log('index login success ');
			}else{
				//这里处理未登录的逻辑
				console.log('index login failure');
			}
		}
		//对外暴露接口时,使用高阶函数包一层,来判断当前页面的登录状态
		window.renderIndex=withLogin(renderIndex);
	})();	
	
	(function(){
		var withLogin=window.withLogin;
		var renderPersonal=function(loginInfo){
			if(loginInfo.login){
				console.log('personal login success ');
			}else{
				console.log('personal login failure');
			}
		}
		
		window.renderPersonal=withLogin(renderPersonal);
	})();
	
	window.renderIndex();
	window.renderPersonal();
</script>
</body>
</html>