<style>
    #container_bill input{
        width:50px;
    }
    #container_bill select{
        width:100px;
        min-width:100px;
    }
    #container_bill textarea{
        width:250px;
        height:50px;
    }
    .hander1{display:block;width:100%;height:25px;background:#ccc;text-align:center;font-size:12px;color:#333;line-height:25px;font-style:normal;}
    .hander2{display:block;width:100%;height:25px;background:#ccc;text-align:center;font-size:12px;color:#333;line-height:25px;font-style:normal;}
    #balance_list_div span input,select{
        width:100px;
    }
    .balance_list_title span{
        display:inline-block;
        width:150px;
    }
    .keyword_list_title span{
        display:inline-block;
        width:100px;
    }
    #keyword_balance_list_div input{
        width:85px;
    }
</style>
<form method="post" action="<{$url}>">
    <table>
        <tr>
            <td>开始时间：<{$start_time}></td>
            <td>结束时间：<{$end_time}></td>
            <td>包名：<{$package_name}></td>
            <td>对接商务：<{$join_business}></td>
        </tr>
        <tr>
            <td>订单完成情况：<{$bill_status}></td>
            <td>是否结清：<{$is_finish}></td>
            <td>ID：<{$id}></td>
            <td style="text-align: left"><input type="submit" value="查询" ></td>
        </tr>
    </table>
</form>
<br><hr style="width:950px;clear:both;"/><br>
实际订单总额：
<volist name="money_total" id="vo">
    <b style="color: red"><{$vo.bill_true_amount}></b><{$vo.money_type}> &nbsp;&nbsp;&nbsp;&nbsp;
</volist><br>
已结清总收入：
<volist name="money_total" id="vo">
    <b style="color: red"><{$vo.finish_true_amount}></b><{$vo.money_type}> &nbsp;&nbsp;&nbsp;&nbsp;
</volist><br>
占比：
<volist name="money_total" id="vo">
    <b style="color: red"><{$vo.finish_true_amout_rate}></b><{$vo.money_type}> &nbsp;&nbsp;&nbsp;&nbsp;
</volist><br>
CPI总数：<b style="color: red"><{$total.cpi_count}></b>&nbsp;&nbsp; &nbsp;&nbsp;
<br />
<div>
    <input type="button" name="export" value="    导出数据    " onclick="location.href='index.php?m=Home&c=File&a=down&module=asoBillList'">
</div>
<br />
<div class="clear"></div>
<table id="example" class="display" cellspacing="0" width="100%">
    <thead>
    <tr><th>ID</th><th>对接商务</th><th>游戏名称</th><th>包名</th><th>下单时间</th><th>投放时间</th><th>订单类型</th><th>任务概要</th><th>CPI值</th><th>订单价格</th><th>订单预付款</th><th>订单实际收入</th><th>货币种类</th><th>订单完成情况</th><th>收款详情</th><th>是否结清</th><th>收款凭证</th><th>结算详情</th><th>操作</th></tr>
    </thead>
    <tbody>
    <volist name="result" id="vo">
        <tr id=<{$vo.exception}> >
            <td><{$vo.id}></td>
            <td><{$vo.join_business}></td>
            <td><{$vo.game_name}></td>
            <td><div style="overflow-y: scroll;width: 200px;height: 50px;white-space: normal;"><a target="_blank" href="<{$vo.appannieUrl}>" title=\"点击查看appannie\"><{$vo.package_name}></a></div></td>
            <td><{$vo.time}></td>
            <td><{$vo.send_time}><br><{$vo.send_time_end}></td>
            <td><{$vo.sale_bill_type}></td>
            <td><div style="overflow-y: scroll;width: 300px;height: 40px;white-space: normal;"><{$vo.bill_detail}></div></td>
            <td><{$vo.cpi_count}></td>
            <td><{$vo.bill_amount}></td>
            <td><{$vo.bill_product}></td>
            <td><{$vo.bill_true_amount}></td>
            <td><{$vo.money_type}></td>
            <td><{$vo.bill_status}></td>
            <td><{$vo.collection_id}></td>
            <td><{$vo.is_finish}></td>
            <td><{$vo.file_name}></td>
            <td><{$vo.balance_detail}></td>
            <td><{$vo.caozuo}></td>
        </tr>
    </volist>
    </tbody>
</table>

<div class="group_detail_div_bill" style="display: none;position: absolute;background-color: #00E8D7;padding: 10px">
    <div style="height: 18px;text-align: right" class="hander1"><span class="icon_delete group_close_bill" style="cursor: pointer"></span></div>
    <div style="background-color: white">
        <div class="tag_title" style="text-align: center"></div>
        <div style="margin: 5px 0 0 5px;">
            <{$add_button}>
        </div>
    </div>
    <div id="data_hid_bill" style="display: none"></div>
    <div id="container_bill" style="min-width: 310px; margin: 0 auto;background-color: #fff"></div>
    <div id="detail_container_bill" style="display: none;position: absolute;top: 40px;left: 50px;width: 950px;background-color: orange;padding: 10px">
        <div style="height: 18px;text-align: right"><span class="icon_delete add_close_bill" style="cursor: pointer"></span></div>
        <div style="width:950px; margin: 0 auto;background-color: #fff" class="balance_add_html">
            <div class="balance_list_title"><span>时间</span><span>类型</span><span>金额</span><span>货币种类</span><span>收支类型</span><span>收支详情</span><span class="balance_one_add icon_add" style="width:18px;cursor: pointer;"></span></div>
            <div id="balance_list_div">
                <{$balance_add}>
            </div>
            <div><span class='balance_add ajax_sel' style='display: inline-block;width:30px;height:20px;text-align: center;cursor: pointer'>提交</span></div>
        </div>
    </div>
</div>
<div id="balance_hidden" style="display: none"><{$balance_add}></div>
<div class="group_detail_div" style="display: none;position: absolute;background-color: #00E8D7;padding: 10px">
    <div style="height: 18px;text-align: right" class="hander2"><span class="icon_delete group_close" style="cursor: pointer"></span></div>
    <div style="height: 60px;background-color: white">
        <div class="tag1" style="float: left;margin: 20px 0 0 20px">
            <input type="text" name="highcharts_start">
            <input type="text" name="highcharts_end">
            <span class="ajax hightcharts_search">查询</span>
        </div>
    </div>
    <div id="data_hid" style="display: none"></div>
    <div id="container" style="min-width: 310px; height: 400px; width:800px; margin: 0 auto"></div>
</div>
<div class="picture_div" style="display: none;position: absolute;background-color: #00E8D7;padding: 10px">
    <div style="height: 18px;text-align: right" class="hander2"><span class="icon_delete group_close" style="cursor: pointer"></span></div>
    <div style="height: 60px;background-color: white" class="picture_show">

    </div>
</div>
<script>
    $(document).ready(function() {
        $('#example').dataTable({
            "aaSorting": [[ 0, "desc" ]],
            "aLengthMenu":[100,50,10],
            "oLanguage": {    // 语言设置
                "sLengthMenu": "每页显示 _MENU_ 条记录",
                "sZeroRecords": "抱歉， 没有找到",
                "sInfo": "从 _START_ 到 _END_ /共 _TOTAL_ 条数据",
                "sInfoEmpty": "没有数据",
                "sInfoFiltered": "(从 _MAX_ 条数据中检索)",
                "sZeroRecords": "没有检索到数据",
                "sSearch": "检索:",
                "oPaginate": {
                    "sFirst": "首页",
                    "sPrevious": "前一页",
                    "sNext": "后一页",
                    "sLast": "尾页"
                }
            }
        });
    });

    $(".picture").click(function(){
        $(".picture_div").show();
        var datas = $(this).attr('attr');
        var url = "index.php?m=Home&c=Sale&a=asoBillList&method=picture";
        $.ajax({
            url : url,
            type : 'post',
            data:{datas:datas},
            success : function(result){
                $(".picture_show").html(result);
                var top = ($(window).height() - $("#popDiv").height())/2;
                var scrollTop = $(document).scrollTop();
                $(".picture_div").css( { 'display' : 'block', 'top' : top + scrollTop - 400,'margin-left' : '30px'} ).show();
            }
        });
        return false;
    });

    $(".history").click(function(){
        $(".balance_add_html").show();
        var datas = $(this).attr('attr');
        var did = $(this).attr('did');
        var dtime = $(this).attr('dtime');
        var djoin_business = $(this).attr('djoin_business');
        $(".tag_title").html("<table style='display: inline'><tr><th>订单日期："+dtime+"</th><th>订单号："+did+"</th><th>商务："+djoin_business+"</th></tr></table>");
        var the = $(this);
        $("#data_hid_bill").html(datas);
        $(".group_detail_div_bill").show();
        $(".add_pop_bill").show();
        var url = "index.php?m=Home&c=Sale&a=getBalanceDetailList";
        $.ajax({
            url : url,
            type : 'post',
            data:{datas:datas,type:'show'},
            success : function(result){
                $("#container_bill").html(result);

                $(".group_detail_div_bill").dragging({
                    move : 'both',
                    randomPosition : true ,
                    hander:'.hander1'
                });

                $(".balance_edit").click(function(){
                    var balance_id = $(this).attr("attr");
                    var balance_time = $(this).parent().parent().children().eq(0).children('input[name="balance_time"]').val();
                    var balance_type = $(this).parent().parent().children().eq(1).children('select[name="balance_type"]').val();
                    var balance_money = $(this).parent().parent().children().eq(2).children('input[name="balance_money"]').val();
                    var money_type = $(this).parent().parent().children().eq(3).children('select[name="money_type"]').val();
                    var balance_paytype = $(this).parent().parent().children().eq(4).children('select[name="balance_paytype"]').val();
                    var balance_paydetail = $(this).parent().parent().children().eq(5).children('textarea[name="balance_paydetail"]').val();
                    var datas = $("#data_hid_bill").html();
                    if (balance_money == null || balance_money == "") {
                        alert('金额不能为空');
                        return false;
                    }
                    if (datas == null || datas == "") {
                        alert('数据错误');
                        return false;
                    }
                    $.ajax({
                        url : "index.php?m=Home&c=Sale&a=BalanceDetailEdit&type=edit",
                        type : 'post',
                        data:{balance_time:balance_time,balance_type:balance_type,balance_money:balance_money,money_type:money_type,balance_paytype:balance_paytype,balance_paydetail:balance_paydetail,datas:datas,balance_id:balance_id},
                        success : function(data){
                            alert(data);
                            the.click();
                        }
                    });
                });


                $(".balance_del").click(function(){
                    var balance_id = $(this).attr("attr");
                    $.ajax({
                        url : "index.php?m=Home&c=Sale&a=BalanceDetailEdit&type=del",
                        type : 'post',
                        data:{balance_id:balance_id},
                        success : function(data){
                            alert(data);
                            the.click();
                        }
                    });
                });
            }
        });
        return false;
    });

    $(".balance_add").click(function(){
        var balance_time = '';
        $("#balance_list_div input[name='balance_time[]']").each(function () {
            balance_time += balance_time ? ',' + $(this).val() : $(this).val();
        });
        if (!balance_time) {
            alert('请填写出入账时间');
            return false;
        }
        var balance_type = '';
        $("#balance_list_div select[name='balance_type[]']").each(function () {
            balance_type += balance_type ? ',' + $(this).val() : $(this).val();
        });
        var balance_money = '';
        $("#balance_list_div input[name='balance_money[]']").each(function () {
            balance_money += balance_money ? ',' + $(this).val() : $(this).val();
        });
        if (!balance_money) {
            alert('请填写金额');
            return false;
        }
        var money_type = '';
        $("#balance_list_div select[name='money_type[]']").each(function () {
            money_type += money_type ? ',' + $(this).val() : $(this).val();
        });
        var balance_paytype = '';
        $("#balance_list_div select[name='balance_paytype[]']").each(function () {
            balance_paytype += balance_paytype ? ',' + $(this).val() : $(this).val();
        });
        var balance_paydetail = '';
        $("#balance_list_div textarea[name='balance_paydetail[]']").each(function () {
            balance_paydetail += balance_paydetail ? ',' + $(this).val() : $(this).val();
        });
        var datas = $("#data_hid_bill").html();
        if (datas == null || datas == "") {
            alert('数据错误');
            return false;
        }
        $.ajax({
            url : "index.php?m=Home&c=Sale&a=BalanceDetailEdit&type=add",
            type : 'post',
            data:{balance_time:balance_time,balance_type:balance_type,money_type:money_type,balance_money:balance_money,balance_paytype:balance_paytype,balance_paydetail:balance_paydetail,datas:datas},
            success : function(data){
                alert(data);
                $("#detail_container_bill").hide();
                $("span[attr='"+datas+"'][class='history icon_add']").click();
            }
        });
    });

    $(".group_close_bill").click(function(){
        $(".group_detail_div_bill").hide();
    });

    $(".add_pop_bill").click(function(){
        $("#detail_container_bill").show();
        $("#keyword_detail_container_bill").hide();
        $(".balance_one_add").click(function(){
            var str = $("#balance_hidden").html();
            $("#balance_list_div").append(str);
            $(".balance_one_del").click(function(){
                $(this).parent().remove();
            });
        });
    });

    $(".add_close_bill").click(function(){
        $("#detail_container_bill").hide();
        $("#keyword_detail_container_bill").hide();
    });


    $(".group_close").click(function(){
        $(".group_detail_div").hide();
        $(".picture_div").hide();
    });

    $.fn.extend({
        //---元素拖动插件
        dragging:function(data){
            var $this = $(this);
            var xPage;
            var yPage;
            var X;//
            var Y;//
            var xRand = 0;//
            var yRand = 0;//
            var father = $this.parent();
            var defaults = {
                move : 'both',
                randomPosition : true ,
                hander:1
            }
            var opt = $.extend({},defaults,data);
            var movePosition = opt.move;
            var random = opt.randomPosition;

            var hander = opt.hander;

            if(hander == 1){
                hander = $this;
            }else{
                hander = $this.find(opt.hander);
            }


            //---初始化
            $this.css({"position":"absolute"});
            hander.css({"cursor":"move"});

            var faWidth = father.width();
            var faHeight = father.height();
            var thisWidth = $this.width()+parseInt($this.css('padding-left'))+parseInt($this.css('padding-right'));
            var thisHeight = $this.height()+parseInt($this.css('padding-top'))+parseInt($this.css('padding-bottom'));

            var mDown = false;//
            var positionX;
            var positionY;
            var moveX ;
            var moveY ;

            if(random){
                $thisRandom();
            }
            function $thisRandom(){ //随机函数
                $this.each(function(index){
//                    var randY = parseInt(Math.random()*(faHeight-thisHeight));///
//                    var randX = parseInt(Math.random()*(faWidth-thisWidth));///
                    var randY = ($(window).height())/2 + $(document).scrollTop() - 400;///
                    var randX = 30;///
                    if(movePosition.toLowerCase() == 'x'){
                        $(this).css({
                            left:randX
                        });
                    }else if(movePosition.toLowerCase() == 'y'){
                        $(this).css({
                            top:randY
                        });
                    }else if(movePosition.toLowerCase() == 'both'){
                        $(this).css({
                            top:randY,
                            left:randX
                        });
                    }

                });
            }

            hander.mousedown(function(e){
                father.children().css({"zIndex":"0"});
                $this.css({"zIndex":"1"});
                mDown = true;
                X = e.pageX;
                Y = e.pageY;
                positionX = $this.position().left;
                positionY = $this.position().top;
                return false;
            });

            $(document).mouseup(function(e){
                mDown = false;
            });

            $(document).mousemove(function(e){
                xPage = e.pageX;//--
                moveX = positionX+xPage-X;

                yPage = e.pageY;//--
                moveY = positionY+yPage-Y;

                function thisXMove(){ //x轴移动
                    if(mDown == true){
                        $this.css({"left":moveX});
                    }else{
                        return;
                    }
                    if(moveX < 0){
                        $this.css({"left":"0"});
                    }
                    if(moveX > (faWidth-thisWidth)){
                        $this.css({"left":faWidth-thisWidth});
                    }
                    return moveX;
                }

                function thisYMove(){ //y轴移动
                    if(mDown == true){
                        $this.css({"top":moveY});
                    }else{
                        return;
                    }
                    if(moveY < 0){
                        $this.css({"top":"0"});
                    }
                    if(moveY > (faHeight-thisHeight)){
                        $this.css({"top":faHeight-thisHeight});
                    }
                    return moveY;
                }

                function thisAllMove(){ //全部移动
                    if(mDown == true){
                        $this.css({"left":moveX,"top":moveY});
                    }else{
                        return;
                    }
                    if(moveX < 0){
                        $this.css({"left":"0"});
                    }
                    if(moveX > (faWidth-thisWidth)){
                        $this.css({"left":faWidth-thisWidth});
                    }

                    if(moveY < 0){
                        $this.css({"top":"0"});
                    }
                    if(moveY > (faHeight-thisHeight)){
                        $this.css({"top":faHeight-thisHeight});
                    }
                }
                if(movePosition.toLowerCase() == "x"){
                    thisXMove();
                }else if(movePosition.toLowerCase() == "y"){
                    thisYMove();
                }else if(movePosition.toLowerCase() == 'both'){
                    thisAllMove();
                }
            });
        }
    });
</script>